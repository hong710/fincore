{% load humanize %}
<div class="overflow-auto">
  <table class="min-w-full table-auto text-sm text-slate-800">
    <thead class="bg-slate-50 text-xs font-medium text-slate-700 border-b border-slate-200">
      <tr class="sticky top-0 bg-slate-50">
        <th class="py-2 px-4 text-left">Category</th>
        <th class="py-2 px-4 text-right">Amount</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-slate-200">
      {% if income_rows or cogs_rows or expense_rows %}
        <tr class="bg-slate-50 text-xs font-semibold uppercase tracking-wide text-slate-600">
          <td class="px-4 py-2" colspan="2">Income</td>
        </tr>
        {% if income_rows %}
          {% for row in income_rows %}
            <tr class="hover:bg-slate-50">
              <td class="px-4 py-2 text-sm text-slate-700">
                <a class="text-indigo-600 hover:text-indigo-700" href="{% url 'fincore:category_report' row.category_id %}?date_range={{ filters.date_range }}{% if filters.date_range == 'custom' and filters.date_from %}&date_from={{ filters.date_from }}{% endif %}{% if filters.date_range == 'custom' and filters.date_to %}&date_to={{ filters.date_to }}{% endif %}">{{ row.category__name }}</a>
              </td>
              <td class="px-4 py-2 text-right text-sm text-emerald-600">{{ row.display_total|floatformat:2|intcomma }}</td>
            </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td class="px-4 py-3 text-sm text-slate-500" colspan="2">No income in this period.</td>
          </tr>
        {% endif %}
        <tr class="bg-slate-50 text-sm font-semibold text-slate-700">
          <td class="px-4 py-2">Total Income</td>
          <td class="px-4 py-2 text-right text-emerald-600">{{ income_total_display|floatformat:2|intcomma }}</td>
        </tr>

        <tr class="bg-slate-50 text-xs font-semibold uppercase tracking-wide text-slate-600">
          <td class="px-4 py-2" colspan="2">COGS (Cost of Goods Sold)</td>
        </tr>
        {% if cogs_rows %}
          {% for row in cogs_rows %}
            <tr class="hover:bg-slate-50">
              <td class="px-4 py-2 text-sm text-slate-700">
                <a class="text-indigo-600 hover:text-indigo-700" href="{% url 'fincore:category_report' row.category_id %}?date_range={{ filters.date_range }}{% if filters.date_range == 'custom' and filters.date_from %}&date_from={{ filters.date_from }}{% endif %}{% if filters.date_range == 'custom' and filters.date_to %}&date_to={{ filters.date_to }}{% endif %}">{{ row.category__name }}</a>
              </td>
              <td class="px-4 py-2 text-right text-sm text-rose-600">{{ row.display_total|floatformat:2|intcomma }}</td>
            </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td class="px-4 py-3 text-sm text-slate-500" colspan="2">No COGS in this period.</td>
          </tr>
        {% endif %}
        <tr class="bg-slate-50 text-sm font-semibold text-slate-700">
          <td class="px-4 py-2">Total COGS</td>
          <td class="px-4 py-2 text-right text-rose-600">{{ cogs_total_display|floatformat:2|intcomma }}</td>
        </tr>

        <tr class="bg-slate-50 text-xs font-semibold uppercase tracking-wide text-slate-600">
          <td class="px-4 py-2" colspan="2">Expenses</td>
        </tr>
        {% if expense_rows %}
          {% for row in expense_rows %}
            <tr class="hover:bg-slate-50">
              <td class="px-4 py-2 text-sm text-slate-700">
                <a class="text-indigo-600 hover:text-indigo-700" href="{% url 'fincore:category_report' row.category_id %}?date_range={{ filters.date_range }}{% if filters.date_range == 'custom' and filters.date_from %}&date_from={{ filters.date_from }}{% endif %}{% if filters.date_range == 'custom' and filters.date_to %}&date_to={{ filters.date_to }}{% endif %}">{{ row.category__name }}</a>
              </td>
              <td class="px-4 py-2 text-right text-sm text-rose-600">{{ row.display_total|floatformat:2|intcomma }}</td>
            </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td class="px-4 py-3 text-sm text-slate-500" colspan="2">No expenses in this period.</td>
          </tr>
        {% endif %}
        <tr class="bg-slate-50 text-sm font-semibold text-slate-700">
          <td class="px-4 py-2">Total Expenses</td>
          <td class="px-4 py-2 text-right text-rose-600">{{ expense_total_display|floatformat:2|intcomma }}</td>
        </tr>

        <tr class="bg-indigo-50 text-sm font-semibold text-slate-900">
          <td class="px-4 py-3">Net Income</td>
          <td class="px-4 py-3 text-right {% if net_income_is_negative %}text-rose-600{% else %}text-emerald-600{% endif %}">
            {{ net_income_display|floatformat:2|intcomma }}
          </td>
        </tr>
      {% else %}
        <tr>
          <td colspan="2" class="px-4 py-6 text-center text-sm text-slate-500">No profit &amp; loss data for the selected filters.</td>
        </tr>
      {% endif %}
    </tbody>
  </table>
</div>
