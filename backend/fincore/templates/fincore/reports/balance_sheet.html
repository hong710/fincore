{% extends "fincore/base.html" %}
{% block title %}Balance Sheet · Fincore{% endblock %}

{% block content %}
<div class="space-y-4 flex flex-col h-full">
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-lg font-semibold text-slate-900">Balance Sheet</h1>
      <p class="text-sm text-slate-500">Snapshot of assets, liabilities, and equity.</p>
    </div>
  </div>

  <form
    class="rounded-lg border border-slate-200 bg-white p-4 shadow-sm"
    id="bs-form"
    hx-get="{% url 'fincore:balance_sheet_content' %}"
    hx-target="#bs-content"
    hx-swap="innerHTML"
    hx-push-url="true"
    hx-trigger="change delay:200ms"
  >
    <div class="flex flex-wrap items-end gap-4" x-data="{ range: '{{ filters.date_range }}' }">
      <label class="space-y-1 text-xs font-medium text-slate-600">
        <span>Report period</span>
        <select
          name="date_range"
          class="w-56 rounded-md border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700 focus:border-indigo-500 focus:ring-indigo-500"
          x-model="range"
        >
          {% for value, label in report_ranges %}
            <option value="{{ value }}" {% if filters.date_range == value %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </label>

      <label class="space-y-1 text-xs font-medium text-slate-600" x-show="range === 'custom'">
        <span>From</span>
        <input
          type="date"
          name="date_from"
          value="{{ filters.date_from }}"
          :disabled="range !== 'custom'"
          class="w-40 rounded-md border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700 focus:border-indigo-500 focus:ring-indigo-500"
        >
      </label>
      <label class="space-y-1 text-xs font-medium text-slate-600" x-show="range === 'custom'">
        <span>To</span>
        <input
          type="date"
          name="date_to"
          value="{{ filters.date_to }}"
          :disabled="range !== 'custom'"
          class="w-40 rounded-md border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700 focus:border-indigo-500 focus:ring-indigo-500"
        >
      </label>

      <label class="space-y-1 text-xs font-medium text-slate-600">
        <span>Account</span>
        <select
          name="account_id"
          class="w-56 rounded-md border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700 focus:border-indigo-500 focus:ring-indigo-500"
        >
          <option value="" {% if filters.account_id == '' %}selected{% endif %}>All accounts</option>
          {% for account in accounts %}
            <option value="{{ account.id }}" {% if filters.account_id|stringformat:"s" == account.id|stringformat:"s" %}selected{% endif %}>{% if account.parent_id %}• {% endif %}{{ account.name }}</option>
          {% endfor %}
        </select>
      </label>

      <label class="space-y-1 text-xs font-medium text-slate-600">
        <span>Category</span>
        <select
          name="category_id"
          class="w-56 rounded-md border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700 focus:border-indigo-500 focus:ring-indigo-500"
        >
          <option value="" {% if filters.category_id == '' %}selected{% endif %}>All categories</option>
          {% for category in categories %}
            <option value="{{ category.id }}" {% if filters.category_id|stringformat:"s" == category.id|stringformat:"s" %}selected{% endif %}>{{ category.name }} ({{ category.kind }})</option>
          {% endfor %}
        </select>
      </label>

      <label class="space-y-1 text-xs font-medium text-slate-600">
        <span>Type</span>
        <select
          name="kind"
          class="w-40 rounded-md border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700 focus:border-indigo-500 focus:ring-indigo-500"
        >
          <option value="all" {% if filters.kind == 'all' %}selected{% endif %}>All</option>
          <option value="assets" {% if filters.kind == 'assets' %}selected{% endif %}>Assets</option>
          <option value="liability" {% if filters.kind == 'liability' %}selected{% endif %}>Liabilities</option>
          <option value="equity" {% if filters.kind == 'equity' %}selected{% endif %}>Equity</option>
        </select>
      </label>

      <a
        href="{% url 'fincore:balance_sheet_report' %}"
        class="inline-flex items-center gap-2 rounded-md border border-slate-200 px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 cursor-pointer"
      >
        Clear Filters
      </a>
    </div>
  </form>

  <div
    id="bs-content"
    class="overflow-hidden rounded-lg border border-slate-200 bg-white shadow-sm flex-1 min-h-0"
  >
    {% include "fincore/reports/balance_sheet_content.html" %}
  </div>
</div>
{% endblock %}
