<table class="min-w-full table-auto text-sm text-slate-800">
  <thead class="bg-slate-50 text-xs font-medium text-slate-700 border-b border-slate-200">
    <tr class="sticky top-0 bg-slate-50">
      <th class="py-1.5 px-3 text-left align-top w-10">
        <input type="checkbox" 
          class="rounded border-slate-300 text-indigo-600 focus:ring-indigo-500"
          :checked="(() => { const pageIds = [{% for txn in page_obj.object_list %}{{ txn.id }}{% if not forloop.last %},{% endif %}{% endfor %}]; const selectedOnPage = (selectedIds || []).filter(id => pageIds.includes(id)).length; return pageIds.length > 0 && selectedOnPage === pageIds.length; })()"
          :indeterminate="(() => { const pageIds = [{% for txn in page_obj.object_list %}{{ txn.id }}{% if not forloop.last %},{% endif %}{% endfor %}]; const selectedOnPage = (selectedIds || []).filter(id => pageIds.includes(id)).length; return selectedOnPage > 0 && selectedOnPage < pageIds.length; })()"
          @click="(() => { const pageIds = [{% for txn in page_obj.object_list %}{{ txn.id }}{% if not forloop.last %},{% endif %}{% endfor %}]; const selectedOnPage = (selectedIds || []).filter(id => pageIds.includes(id)).length; if (selectedOnPage === pageIds.length && pageIds.length > 0) { selectedIds = (selectedIds || []).filter(id => !pageIds.includes(id)); } else { selectedIds = Array.from(new Set([...(selectedIds || []), ...pageIds])); } })()" />
      </th>
      <th class="py-1.5 px-3 text-left align-top w-12">#</th>
      <th class="py-1.5 px-3 text-left align-top">
        <div class="flex items-center gap-2">
          <span class="text-sm text-slate-700">Date</span>
          <div class="relative inline-flex z-20" x-data="{ open: false }">
            <button type="button" class="inline-flex items-center rounded-md border bg-white px-2 py-1 text-xs shadow-sm hover:bg-slate-50" :class="filterActive('date') ? 'border-indigo-500 bg-indigo-50 text-indigo-700' : 'border-slate-200 text-slate-700'" @click="open=!open">
              <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" :class="filterActive('date') ? 'text-indigo-700 fill-current' : 'text-slate-500 fill-none'">
                <path d="M3 4.5h18L14.25 12v5.25l-4.5 2.25V12L3 4.5Z"/>
              </svg>
            </button>
            <div x-cloak x-show="open" @click.outside="open=false" class="absolute left-0 z-50 mt-2 w-60 space-y-3 rounded-md border border-slate-200 bg-white p-3 shadow-md">
              <div class="grid grid-cols-2 gap-2 text-xs font-medium text-slate-700">
                <button type="button" class="rounded-md border px-2 py-1 transition hover:bg-slate-50" :class="draft.dateRange.type==='quick' && draft.dateRange.key==='this_month' ? 'bg-indigo-50 border-indigo-200 text-indigo-700' : 'border-slate-200 text-slate-700'" @click="selectQuickRange('this_month')">This month</button>
                <button type="button" class="rounded-md border px-2 py-1 transition hover:bg-slate-50" :class="draft.dateRange.type==='quick' && draft.dateRange.key==='last_month' ? 'bg-indigo-50 border-indigo-200 text-indigo-700' : 'border-slate-200 text-slate-700'" @click="selectQuickRange('last_month')">Last month</button>
                <button type="button" class="rounded-md border px-2 py-1 transition hover:bg-slate-50" :class="draft.dateRange.type==='quick' && draft.dateRange.key==='q1' ? 'bg-indigo-50 border-indigo-200 text-indigo-700' : 'border-slate-200 text-slate-700'" @click="selectQuickRange('q1')">1st quarter</button>
                <button type="button" class="rounded-md border px-2 py-1 transition hover:bg-slate-50" :class="draft.dateRange.type==='quick' && draft.dateRange.key==='q2' ? 'bg-indigo-50 border-indigo-200 text-indigo-700' : 'border-slate-200 text-slate-700'" @click="selectQuickRange('q2')">2nd quarter</button>
                <button type="button" class="rounded-md border px-2 py-1 transition hover:bg-slate-50" :class="draft.dateRange.type==='quick' && draft.dateRange.key==='q3' ? 'bg-indigo-50 border-indigo-200 text-indigo-700' : 'border-slate-200 text-slate-700'" @click="selectQuickRange('q3')">3rd quarter</button>
                <button type="button" class="rounded-md border px-2 py-1 transition hover:bg-slate-50" :class="draft.dateRange.type==='quick' && draft.dateRange.key==='q4' ? 'bg-indigo-50 border-indigo-200 text-indigo-700' : 'border-slate-200 text-slate-700'" @click="selectQuickRange('q4')">4th quarter</button>
                <button type="button" class="rounded-md border px-2 py-1 transition hover:bg-slate-50" :class="draft.dateRange.type==='quick' && draft.dateRange.key==='this_year' ? 'bg-indigo-50 border-indigo-200 text-indigo-700' : 'border-slate-200 text-slate-700'" @click="selectQuickRange('this_year')">This year</button>
                <button type="button" class="rounded-md border px-2 py-1 transition hover:bg-slate-50" :class="draft.dateRange.type==='quick' && draft.dateRange.key==='last_year' ? 'bg-indigo-50 border-indigo-200 text-indigo-700' : 'border-slate-200 text-slate-700'" @click="selectQuickRange('last_year')">Last year</button>
              </div>
              <div class="space-y-2 text-xs text-slate-700">
                <p class="font-medium">Custom range</p>
                <div class="space-y-2">
                  <label class="relative block w-full">
                    <span class="absolute left-3 top-2 text-[11px] font-semibold uppercase tracking-wide text-slate-400">From</span>
                    <input type="date" class="w-full rounded-md border border-slate-200 px-3 pt-6 pb-2 text-xs font-semibold text-slate-800 placeholder:font-semibold placeholder:text-slate-400 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" x-model="draft.dateRange.from" @input="draft.dateRange.type='custom'">
                  </label>
                  <label class="relative block w-full">
                    <span class="absolute left-3 top-2 text-[11px] font-semibold uppercase tracking-wide text-slate-400">To</span>
                    <input type="date" class="w-full rounded-md border border-slate-200 px-3 pt-6 pb-2 text-xs font-semibold text-slate-800 placeholder:font-semibold placeholder:text-slate-400 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" x-model="draft.dateRange.to" @input="draft.dateRange.type='custom'">
                  </label>
                </div>
              </div>
              <div class="inline-flex rounded-md border border-slate-200 text-xs text-slate-700">
                <button type="button" class="px-2 py-1 hover:bg-slate-50" @click="setSort('date','asc')">Sort A→Z</button>
                <span class="block w-px bg-slate-200"></span>
                <button type="button" class="px-2 py-1 hover:bg-slate-50" @click="setSort('date','desc')">Sort Z→A</button>
              </div>
              <div class="flex justify-end gap-2 pt-1">
                <button type="button" class="rounded-md border border-slate-200 px-3 py-1 text-xs text-slate-700 hover:bg-slate-50" @click="resetDraft('date'); open=false">Cancel</button>
                <button type="button" class="rounded-md border border-slate-200 px-3 py-1 text-xs text-slate-700 hover:bg-slate-50" @click="clearFilter('date'); open=false">Clear</button>
                <button type="button" class="rounded-md bg-indigo-600 px-3 py-1 text-xs font-medium text-white hover:bg-indigo-700" @click="applyDraft('date'); open=false">Apply</button>
              </div>
            </div>
          </div>
        </div>
      </th>
      <th class="py-1.5 px-3 text-left align-top">
        <div class="flex items-center gap-2">
          <span class="text-sm text-slate-700">Vendor</span>
          <div class="relative z-20" x-data="{ open: false }" @keydown.escape.window="open=false">
            <button type="button" class="inline-flex items-center rounded-md border bg-white px-2 py-1 text-xs shadow-sm hover:bg-slate-50" :class="filterActive('payee') ? 'border-indigo-500 bg-indigo-50 text-indigo-700' : 'border-slate-200 text-slate-700'" @click="open=!open">
              <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" :class="filterActive('payee') ? 'text-indigo-700 fill-current' : 'text-slate-500 fill-none'">
                <path d="M3 4.5h18L14.25 12v5.25l-4.5 2.25V12L3 4.5Z"/>
              </svg>
            </button>
            <div x-cloak x-show="open" @click.outside="open=false" class="absolute right-0 z-50 mt-2 w-64 rounded-md border border-slate-200 bg-white p-3 shadow-md space-y-2">
              <div class="relative">
                <input type="text" placeholder="Search payee" class="w-full rounded-md border border-slate-200 px-2 py-1 text-xs text-slate-800 placeholder:text-slate-400 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" x-model="payeeSearch">
              </div>
              <div class="flex items-center gap-2 text-xs text-slate-600">
                <button type="button" class="rounded-md border border-slate-200 px-2 py-1 hover:bg-slate-50" @click="selectAll('payee')">Select all</button>
                <button type="button" class="rounded-md border border-slate-200 px-2 py-1 hover:bg-slate-50" @click="unselectAll('payee')">Unselect all</button>
              </div>
              <div class="max-h-40 space-y-1 overflow-y-auto">
                <template x-for="opt in filteredOptions('payee')" :key="opt">
                  <label class="flex items-center gap-2 text-xs text-slate-700">
                    <input type="checkbox" class="h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500" :value="opt" x-model="draft.payee">
                    <span x-text="opt"></span>
                  </label>
                </template>
              </div>
              <div class="inline-flex rounded-md border border-slate-200 text-xs text-slate-700">
                <button type="button" class="px-2 py-1 hover:bg-slate-50" @click="setSort('payee','asc')">Sort A→Z</button>
                <button type="button" class="border-l border-slate-200 px-2 py-1 hover:bg-slate-50" @click="setSort('payee','desc')">Sort Z→A</button>
              </div>
              <div class="flex justify-end gap-2 pt-1">
                <button type="button" class="rounded-md border border-slate-200 px-3 py-1 text-xs text-slate-700 hover:bg-slate-50" @click="resetDraft('payee'); open=false">Cancel</button>
                <button type="button" class="rounded-md bg-indigo-600 px-3 py-1 text-xs font-medium text-white hover:bg-indigo-700" @click="applyDraft('payee'); open=false">Apply</button>
              </div>
            </div>
          </div>
        </div>
      </th>
      <th class="py-1.5 px-3 text-left align-top">
        <div class="flex items-center gap-2">
          <span class="text-sm text-slate-700">Description</span>
          <div class="relative z-20" x-data="{ open: false }" @keydown.escape.window="open=false">
            <button type="button" class="inline-flex items-center rounded-md border bg-white px-2 py-1 text-xs shadow-sm hover:bg-slate-50" :class="filterActive('description') ? 'border-indigo-500 bg-indigo-50 text-indigo-700' : 'border-slate-200 text-slate-700'" @click="open=!open">
              <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" :class="filterActive('description') ? 'text-indigo-700 fill-current' : 'text-slate-500 fill-none'">
                <path d="M3 4.5h18L14.25 12v5.25l-4.5 2.25V12L3 4.5Z"/>
              </svg>
            </button>
            <div x-cloak x-show="open" @click.outside="open=false" class="absolute right-0 z-50 mt-2 w-64 rounded-md border border-slate-200 bg-white p-3 shadow-md space-y-2">
              <div class="relative">
                <input type="text" placeholder="Search descriptions" class="w-full rounded-md border border-slate-200 px-2 py-1 text-xs text-slate-800 placeholder:text-slate-400 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" x-model="descriptionSearch">
              </div>
              <div class="flex items-center gap-2 text-xs text-slate-600">
                <button type="button" class="rounded-md border border-slate-200 px-2 py-1 hover:bg-slate-50" @click="selectAll('description')">Select all</button>
                <button type="button" class="rounded-md border border-slate-200 px-2 py-1 hover:bg-slate-50" @click="unselectAll('description')">Unselect all</button>
              </div>
              <div class="max-h-40 space-y-1 overflow-y-auto">
                <template x-for="opt in filteredOptions('description')" :key="opt">
                  <label class="flex items-center gap-2 text-xs text-slate-700">
                    <input type="checkbox" class="h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500" :value="opt" x-model="draft.description">
                    <span x-text="opt"></span>
                  </label>
                </template>
              </div>
              <div class="inline-flex rounded-md border border-slate-200 text-xs text-slate-700">
                <button type="button" class="px-2 py-1 hover:bg-slate-50" @click="setSort('description','asc')">Sort A→Z</button>
                <button type="button" class="border-l border-slate-200 px-2 py-1 hover:bg-slate-50" @click="setSort('description','desc')">Sort Z→A</button>
              </div>
              <div class="flex justify-end gap-2 pt-1">
                <button type="button" class="rounded-md border border-slate-200 px-3 py-1 text-xs text-slate-700 hover:bg-slate-50" @click="resetDraft('description'); open=false">Cancel</button>
                <button type="button" class="rounded-md bg-indigo-600 px-3 py-1 text-xs font-medium text-white hover:bg-indigo-700" @click="applyDraft('description'); open=false">Apply</button>
              </div>
            </div>
          </div>
        </div>
      </th>
      <th class="py-1.5 px-3 text-left align-top">
        <div class="flex items-center gap-2">
          <span class="text-sm text-slate-700">Category</span>
          <div class="relative z-20" x-data="{ open: false }" @keydown.escape.window="open=false">
            <button type="button" class="inline-flex items-center rounded-md border bg-white px-2 py-1 text-xs shadow-sm hover:bg-slate-50" :class="filterActive('category') ? 'border-indigo-500 bg-indigo-50 text-indigo-700' : 'border-slate-200 text-slate-700'" @click="open=!open">
              <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" :class="filterActive('category') ? 'text-indigo-700 fill-current' : 'text-slate-500 fill-none'">
                <path d="M3 4.5h18L14.25 12v5.25l-4.5 2.25V12L3 4.5Z"/>
              </svg>
            </button>
            <div x-cloak x-show="open" @click.outside="open=false" class="absolute right-0 z-50 mt-2 w-64 rounded-md border border-slate-200 bg-white p-3 shadow-md space-y-2">
              <div class="relative">
                <input type="text" placeholder="Search category" class="w-full rounded-md border border-slate-200 px-2 py-1 text-xs text-slate-800 placeholder:text-slate-400 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" x-model="categorySearch">
              </div>
              <div class="flex items-center gap-2 text-xs text-slate-600">
                <button type="button" class="rounded-md border border-slate-200 px-2 py-1 hover:bg-slate-50" @click="selectAll('category')">Select all</button>
                <button type="button" class="rounded-md border border-slate-200 px-2 py-1 hover:bg-slate-50" @click="unselectAll('category')">Unselect all</button>
              </div>
              <div class="max-h-40 space-y-1 overflow-y-auto">
                <template x-for="opt in filteredCategoryOptions()" :key="opt.category_id">
                  <label class="flex items-center gap-2 text-xs text-slate-700">
                    <input type="checkbox" class="h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500" :value="String(opt.category_id)" x-model="draft.category">
                    <span x-text="opt.category__name"></span>
                  </label>
                </template>
              </div>
              <div class="flex justify-end gap-2 pt-1">
                <button type="button" class="rounded-md border border-slate-200 px-3 py-1 text-xs text-slate-700 hover:bg-slate-50" @click="resetDraft('category'); open=false">Cancel</button>
                <button type="button" class="rounded-md border border-slate-200 px-3 py-1 text-xs text-slate-700 hover:bg-slate-50" @click="clearFilter('category'); open=false">Clear</button>
                <button type="button" class="rounded-md bg-indigo-600 px-3 py-1 text-xs font-medium text-white hover:bg-indigo-700" @click="applyDraft('category'); open=false">Apply</button>
              </div>
            </div>
          </div>
        </div>
      </th>
      <th class="py-1.5 px-3 text-left align-top">
        <div class="flex items-center gap-2">
          <span class="text-sm text-slate-700">Kind</span>
          <div class="relative z-20" x-data="{ open: false }" @keydown.escape.window="open=false">
            <button type="button" class="inline-flex items-center rounded-md border bg-white px-2 py-1 text-xs shadow-sm hover:bg-slate-50" :class="filterActive('kind') ? 'border-indigo-500 bg-indigo-50 text-indigo-700' : 'border-slate-200 text-slate-700'" @click="open=!open">
              <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" :class="filterActive('kind') ? 'text-indigo-700 fill-current' : 'text-slate-500 fill-none'">
                <path d="M3 4.5h18L14.25 12v5.25l-4.5 2.25V12L3 4.5Z"/>
              </svg>
            </button>
            <div x-cloak x-show="open" @click.outside="open=false" class="absolute right-0 z-50 mt-2 w-56 rounded-md border border-slate-200 bg-white p-3 shadow-md space-y-2">
              <div class="relative">
                <input type="text" placeholder="Search kind" class="w-full rounded-md border border-slate-200 px-2 py-1 text-xs text-slate-800 placeholder:text-slate-400 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" x-model="kindSearch">
              </div>
              <div class="flex items-center gap-2 text-xs text-slate-600">
                <button type="button" class="rounded-md border border-slate-200 px-2 py-1 hover:bg-slate-50" @click="selectAll('kind')">Select all</button>
                <button type="button" class="rounded-md border border-slate-200 px-2 py-1 hover:bg-slate-50" @click="unselectAll('kind')">Unselect all</button>
              </div>
              <div class="max-h-40 space-y-1 overflow-y-auto">
                <template x-for="opt in filteredOptions('kind')" :key="opt">
                  <label class="flex items-center gap-2 text-xs text-slate-700">
                    <input type="checkbox" class="h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500" :value="opt" x-model="draft.kind">
                    <span class="capitalize" x-text="opt"></span>
                  </label>
                </template>
              </div>
              <div class="inline-flex rounded-md border border-slate-200 text-xs text-slate-700">
                <button type="button" class="px-2 py-1 hover:bg-slate-50" @click="setSort('kind','asc')">Sort A→Z</button>
                <button type="button" class="border-l border-slate-200 px-2 py-1 hover:bg-slate-50" @click="setSort('kind','desc')">Sort Z→A</button>
              </div>
              <div class="flex justify-end gap-2 pt-1">
                <button type="button" class="rounded-md border border-slate-200 px-3 py-1 text-xs text-slate-700 hover:bg-slate-50" @click="resetDraft('kind'); open=false">Cancel</button>
                <button type="button" class="rounded-md bg-indigo-600 px-3 py-1 text-xs font-medium text-white hover:bg-indigo-700" @click="applyDraft('kind'); open=false">Apply</button>
              </div>
            </div>
          </div>
        </div>
      </th>
      <th class="py-1.5 px-3 text-right align-top">
        <div class="flex items-center justify-end gap-2">
          <span class="text-sm text-slate-700">Amount</span>
          <div class="relative z-20" x-data="{ open: false }" @keydown.escape.window="open=false">
            <button type="button" class="inline-flex items-center rounded-md border bg-white px-2 py-1 text-xs shadow-sm hover:bg-slate-50" :class="filterActive('amount') ? 'border-indigo-500 bg-indigo-50 text-indigo-700' : 'border-slate-200 text-slate-700'" @click="open=!open">
              <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" :class="filterActive('amount') ? 'text-indigo-700 fill-current' : 'text-slate-500 fill-none'">
                <path d="M3 4.5h18L14.25 12v5.25l-4.5 2.25V12L3 4.5Z"/>
              </svg>
            </button>
            <div x-cloak x-show="open" @click.outside="open=false" class="absolute right-0 z-50 mt-2 w-64 rounded-md border border-slate-200 bg-white p-3 shadow-md space-y-3">
              <label class="space-y-1 text-xs text-slate-700">
                <span class="text-[11px] font-semibold uppercase tracking-wide text-slate-400">Type</span>
                <select
                  class="w-full rounded-md border border-slate-200 bg-white px-2 py-1 text-xs text-slate-800 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200"
                  x-model="draft.amount.type"
                  @change="if (draft.amount.type === 'all') { draft.amount.min = ''; draft.amount.max = ''; }"
                >
                  <option value="all">All</option>
                  <option value="expense">Expense (-)</option>
                  <option value="deposit">Deposit (+)</option>
                </select>
              </label>
              <div class="space-y-1 text-xs text-slate-700">
                <p class="text-[11px] font-semibold uppercase tracking-wide text-slate-400">Range</p>
                <div class="flex items-center gap-2">
                  <input
                    type="number"
                    placeholder="Min"
                    class="w-24 rounded-md border border-slate-200 px-2 py-1 text-xs text-slate-800 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200"
                    :class="draft.amount.type === 'all' ? 'bg-slate-100 text-slate-400' : ''"
                    :disabled="draft.amount.type === 'all'"
                    x-model="draft.amount.min"
                  >
                  <input
                    type="number"
                    placeholder="Max"
                    class="w-24 rounded-md border border-slate-200 px-2 py-1 text-xs text-slate-800 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200"
                    :class="draft.amount.type === 'all' ? 'bg-slate-100 text-slate-400' : ''"
                    :disabled="draft.amount.type === 'all'"
                    x-model="draft.amount.max"
                  >
                </div>
              </div>
              <div class="inline-flex rounded-md border border-slate-200 text-xs text-slate-700">
                <button type="button" class="px-2 py-1 hover:bg-slate-50" @click="setSort('amount','asc')">Sort ↑</button>
                <button type="button" class="border-l border-slate-200 px-2 py-1 hover:bg-slate-50" @click="setSort('amount','desc')">Sort ↓</button>
              </div>
              <div class="flex justify-end gap-2 pt-1">
                <button type="button" class="rounded-md border border-slate-200 px-3 py-1 text-xs text-slate-700 hover:bg-slate-50" @click="resetDraft('amount'); open=false">Cancel</button>
                <button type="button" class="rounded-md border border-slate-200 px-3 py-1 text-xs text-slate-700 hover:bg-slate-50" @click="clearFilter('amount'); open=false">Clear</button>
                <button type="button" class="rounded-md bg-indigo-600 px-3 py-1 text-xs font-medium text-white hover:bg-indigo-700" @click="applyDraft('amount'); open=false">Apply</button>
              </div>
            </div>
          </div>
        </div>
      </th>
    </tr>
  </thead>
  <tbody class="divide-y divide-slate-200">
    {% if page_obj.object_list %}
      {% for txn in page_obj.object_list %}
        {% with amount=txn.amount %}
        <tr
          class="h-8 hover:bg-slate-50 transition-colors"
          :class="(selectedIds || []).includes({{ txn.id }}) && 'bg-indigo-50'"
          @dblclick="$dispatch('transaction-edit', {
            id: {{ txn.id }},
            date: '{{ txn.date|date:'Y-m-d' }}',
            vendor_id: '{% if txn.vendor_id %}{{ txn.vendor_id }}{% endif %}',
            description: '{{ txn.description|default:''|escapejs }}',
            category_id: '{% if txn.category_id %}{{ txn.category_id }}{% endif %}',
            kind: '{{ txn.kind }}',
            amount: '{{ txn.amount }}',
            is_imported: {{ txn.is_imported|yesno:'true,false' }},
            account_id: {{ txn.account_id }},
            transfer_group_id: '{% if txn.transfer_group_id %}{{ txn.transfer_group_id }}{% endif %}',
            is_locked: {{ txn.is_locked|yesno:'true,false' }}
          })"
        >
          <td class="px-4 py-0.5 whitespace-nowrap">
            <input type="checkbox" class="rounded border-slate-300 text-indigo-600 focus:ring-indigo-500" 
              :checked="(selectedIds || []).includes({{ txn.id }})"
              @click="(selectedIds || []).includes({{ txn.id }}) ? selectedIds = (selectedIds || []).filter(id => id !== {{ txn.id }}) : (selectedIds || []).push({{ txn.id }})" />
          </td>
          <td class="px-4 py-0.5 whitespace-nowrap text-xs text-slate-600">{{ forloop.counter0|add:page_obj.start_index }}</td>
          <td class="px-4 py-0.5 whitespace-nowrap">
            <div class="flex items-center gap-2">
              <span>{{ txn.date }}</span>
              {% if txn.is_imported %}
                <span class="inline-flex text-[8px] font-semibold capitalize tracking-wide text-blue-600">
                  Import{% if txn.import_batch_id %}-{{ txn.import_batch_id }}{% endif %}
                </span>
              {% endif %}
            </div>
          </td>
          <td class="px-4 py-0.5 whitespace-nowrap">
            {% if txn.vendor %}{{ txn.vendor.name }}{% else %}-{% endif %}
          </td>
          <td class="px-4 py-0.5 whitespace-nowrap" title="{{ txn.description|default:"" }}">{{ txn.description|default:""|truncatewords:15 }}</td>
          <td class="px-4 py-0.5 whitespace-nowrap">{{ txn.category.name|default:"-" }}</td>
          <td class="px-4 py-0.5 whitespace-nowrap">{{ txn.get_kind_display }}</td>
          <td class="px-4 py-0.5 whitespace-nowrap text-right {% if amount > 0 %}text-emerald-600{% elif amount < 0 %}text-rose-600{% else %}text-slate-500{% endif %}">
            {% if amount > 0 %}
              +${{ amount|floatformat:2 }}
            {% elif amount < 0 %}
              -${{ amount|floatformat:2|slice:"1:" }}
            {% else %}
              $0.00
            {% endif %}
          </td>
        </tr>
        {% endwith %}
      {% endfor %}
    {% else %}
      <tr>
        <td colspan="8" class="px-4 py-6 text-center text-sm text-slate-500">No data available</td>
      </tr>
    {% endif %}
  </tbody>
</table>
