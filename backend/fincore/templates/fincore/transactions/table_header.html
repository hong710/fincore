<form
  x-ref="filterForm"
  x-ref:form
  class="flex items-center justify-between border-b border-slate-200 bg-slate-50 px-3 py-2 text-xs text-slate-600"
  hx-get="{% url 'fincore:transaction_table' %}"
  hx-target="#transactions-table"
  hx-push-url="true"
  hx-trigger="submit"
>
  <button x-ref="hiddenSubmit" type="submit" class="hidden" tabindex="-1" aria-hidden="true"></button>
  <div class="flex items-center gap-3 flex-wrap">
    <label class="flex items-center gap-2 text-slate-500">
      <span>Account</span>
      <select
        name="account_id"
        class="rounded-md border border-slate-200 bg-white px-2 py-1 text-xs font-semibold text-slate-700 focus:border-indigo-500 focus:ring-indigo-500"
        x-model.number="accountId"
        @change="page = 1; submitFilters(); $dispatch('transactions:account-selected', { id: accountId })"
        {% if not accounts %}disabled{% endif %}
      >
        {% if accounts %}
          {% for account in accounts %}
            <option value="{{ account.id }}" {% if account.id == selected_account_id %}selected{% endif %}>
              {{ account.name }}
            </option>
          {% endfor %}
        {% else %}
          <option value="">No active accounts</option>
        {% endif %}
      </select>
    </label>
    <label class="flex items-center gap-2 text-slate-500">
      <span>Rows per page</span>
      <select
        name="page_size"
        class="rounded-md border border-slate-200 bg-white px-2 py-1 text-xs text-slate-700 focus:border-indigo-500 focus:ring-indigo-500"
        x-model.number="pageSize"
        @change="page = 1; submitFilters()"
      >
        {% for size in page_sizes %}
          <option value="{{ size }}" {% if page_size == size %}selected{% endif %}>{{ size }}</option>
        {% endfor %}
      </select>
    </label>
    <div class="relative">
      <input id="txn-search" name="q" type="text" class="rounded-md border border-slate-200 bg-white pl-8 pr-7 py-1.5 text-xs text-slate-700 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 w-56" placeholder="Search transactions" x-model="search" @keydown.enter.prevent="submitFilters()">
      <svg class="absolute left-2 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 1 0 5.25 5.25a7.5 7.5 0 0 0 11.4 11.4Z"/></svg>
      <button
        type="button"
        class="absolute right-2 top-1/2 -translate-y-1/2 rounded p-0.5 text-slate-400 hover:text-slate-600"
        x-show="search"
        @click="search=''; submitFilters()"
        aria-label="Clear search"
      >
        <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
  </div>
  <div class="flex items-center gap-3">
    <button
      type="button"
      class="inline-flex items-center gap-1 rounded-md border border-slate-200 bg-white px-2 py-1 text-xs text-slate-700 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed"
      :disabled="selectedIds.length === 0"
      @click="openBulkAction()"
    >
      Bulk Action (<span x-text="selectedIds.length"></span>)
    </button>
    <button
      type="button"
      class="inline-flex items-center gap-1 rounded-md border border-slate-200 bg-white px-2 py-1 text-xs text-slate-700 hover:bg-slate-50"
      @click="resetAllFilters()"
    >
      Reset filters
    </button>
    <span>Showing {{ page_obj.start_index }}-{{ page_obj.end_index }} of {{ paginator.count }} records</span>
    <div class="inline-flex items-center rounded-md border border-slate-200 text-xs text-slate-700 overflow-hidden">
      <button type="submit" class="px-2 py-1 hover:bg-slate-50 {% if not page_obj.has_previous %}opacity-50 cursor-not-allowed{% endif %}" {% if page_obj.has_previous %}@click="page={{ page_obj.previous_page_number }}"{% else %}disabled{% endif %}>Prev</button>
      <span class="border-l border-r border-slate-200 px-2 py-1">{{ page_obj.number }} / {{ paginator.num_pages }}</span>
      <button type="submit" class="px-2 py-1 hover:bg-slate-50 {% if not page_obj.has_next %}opacity-50 cursor-not-allowed{% endif %}" {% if page_obj.has_next %}@click="page={{ page_obj.next_page_number }}"{% else %}disabled{% endif %}>Next</button>
    </div>
  </div>

  <input type="hidden" name="page" x-model.number="page">
  <input type="hidden" name="date_range" :value="dateRangeValue()">
  <input type="hidden" name="date_from" x-model="filters.date.range.from">
  <input type="hidden" name="date_to" x-model="filters.date.range.to">
  <input type="hidden" name="amount_type" x-model="filters.amount.type">
  <input type="hidden" name="amount_min" x-model="filters.amount.min">
  <input type="hidden" name="amount_max" x-model="filters.amount.max">
  <input type="hidden" name="sort" x-model="sortField">
  <input type="hidden" name="dir" x-model="sortDir">

  <template x-for="val in filters.payee.selected" :key="`payee-${val}`">
    <input type="hidden" name="payee" :value="val">
  </template>
  <template x-for="val in filters.description.selected" :key="`desc-${val}`">
    <input type="hidden" name="description" :value="val">
  </template>
  <template x-for="val in filters.kind.selected" :key="`kind-${val}`">
    <input type="hidden" name="kind" :value="val">
  </template>
  <template x-for="val in filters.category.selected" :key="`category-${val}`">
    <input type="hidden" name="category" :value="val">
  </template>
</form>
